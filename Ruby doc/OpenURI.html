<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: OpenURI
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "OpenURI";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (O)</a> &raquo;
    
    
    <span class="title">OpenURI</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: OpenURI
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/open-uri.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>OpenURI is an easy-to-use wrapper for Net::HTTP, Net::HTTPS and Net::FTP.</p>

<h2 id="label-Example">Example</h2>

<p>It is possible to open an http, https or ftp URL as though it were a file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_line'>line</span><span class='rbrace'>}</span>
<span class='rbrace'>}</span>
</code></pre>

<p>The opened file has several getter methods for its meta-information, as
follows, since it is extended by OpenURI::Meta.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_line'>line</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span>         <span class='comment'># &lt;URI::HTTP:0x40e6ef2 URL:http://www.ruby-lang.org/en/&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_content_type'>content_type</span>     <span class='comment'># &quot;text/html&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_charset'>charset</span>          <span class='comment'># &quot;iso-8859-1&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_content_encoding'>content_encoding</span> <span class='comment'># []
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_last_modified'>last_modified</span>    <span class='comment'># Thu Dec 05 02:45:02 UTC 2002
</span><span class='rbrace'>}</span>
</code></pre>

<p>Additional header fields can be specified by an optional hash argument.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User-Agent</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby/</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_VERSION</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>From</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo@bar.invalid</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Referer</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span>
</code></pre>

<p>The environment variables such as http_proxy, https_proxy and ftp_proxy are
in effect by default. Here we disable proxy:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:proxy</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span>
</code></pre>

<p>See OpenURI::OpenRead.open and Kernel#open for more on available options.</p>

<p>URI objects can be opened in a similar way.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="URI.html#parse-class_method" title="URI.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span>
</code></pre>

<p>URI objects can be read directly. The returned string is also extended by
OpenURI::Meta.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span>
</code></pre>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Tanaka Akira &lt;akr@m17n.org&gt;</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="OpenURI/Meta.html" title="OpenURI::Meta (module)">Meta</a></span>, <span class='object_link'><a href="OpenURI/OpenRead.html" title="OpenURI::OpenRead (module)">OpenRead</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="OpenURI/Buffer.html" title="OpenURI::Buffer (class)">Buffer</a></span>, <span class='object_link'><a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a></span>, <span class='object_link'><a href="OpenURI/HTTPRedirect.html" title="OpenURI::HTTPRedirect (class)">HTTPRedirect</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="Options-constant" class="">Options =
        
      </dt>
      <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:proxy</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:proxy_http_basic_authentication</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:progress_proc</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:content_length_proc</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:http_basic_authentication</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:read_timeout</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:open_timeout</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_ca_cert</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_verify_mode</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='symbol'>:ftp_active_mode</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbol'>:redirect</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:encoding</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre></dd>
    
  </dl>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_options-class_method" title="check_options (class method)">.<strong>check_options</strong>(options)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open_http-class_method" title="open_http (class method)">.<strong>open_http</strong>(buf, target, proxy, options)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open_loop-class_method" title="open_loop (class method)">.<strong>open_loop</strong>(uri, options)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open_uri-class_method" title="open_uri (class method)">.<strong>open_uri</strong>(name, *rest)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirectable%3F-class_method" title="redirectable? (class method)">.<strong>redirectable?</strong>(uri1, uri2)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scan_open_optional_arguments-class_method" title="scan_open_optional_arguments (class method)">.<strong>scan_open_optional_arguments</strong>(*rest)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="check_options-class_method">
  
    .<strong>check_options</strong>(options)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 121</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_check_options'>check_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="Symbol.html" title="Symbol (class)">Symbol</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_k'>k</span>
    <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#Options-constant" title="OpenURI::Options (constant)">Options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_k'>k</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unrecognized option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open_http-class_method">
  
    .<strong>open_http</strong>(buf, target, proxy, options)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 269</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open_http'>open_http</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_proxy'>proxy</span>
    <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Non-HTTP proxy URI: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>!=</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/HTTP.html" title="URI::HTTP (class)">HTTP</a></span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>userinfo not supported.  [RFC3986]</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_header'>header</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/http</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTP.html" title="Net::HTTP (class)">HTTP</a></span></span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/HTTP.html" title="URI::HTTP (class)">HTTP</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_target'>target</span>
    <span class='comment'># HTTP or HTTPS
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_proxy'>proxy</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
        <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
        <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTP.html" title="Net::HTTP (class)">HTTP</a></span></span><span class='op'>::</span><span class='const'>Proxy</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTP.html" title="Net::HTTP (class)">HTTP</a></span></span><span class='op'>::</span><span class='const'>Proxy</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_target_host'>target_host</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
    <span class='id identifier rubyid_target_port'>target_port</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>
    <span class='id identifier rubyid_request_uri'>request_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_request_uri'>request_uri</span>
  <span class='kw'>else</span>
    <span class='comment'># FTP over HTTP proxy
</span>    <span class='id identifier rubyid_target_host'>target_host</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
    <span class='id identifier rubyid_target_port'>target_port</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>
    <span class='id identifier rubyid_request_uri'>request_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
      <span class='id identifier rubyid_header'>header</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Proxy-Authorization</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span>
                      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Basic </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_http'>http</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>?</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_target_host'>target_host</span><span class='comma'>,</span> <span class='id identifier rubyid_target_port'>target_port</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_target_host'>target_host</span><span class='comma'>,</span> <span class='id identifier rubyid_target_port'>target_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/HTTPS.html" title="URI::HTTPS (class)">HTTPS</a></span></span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/https</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_use_ssl'>use_ssl</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:ssl_verify_mode</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenSSL/SSL.html" title="OpenSSL::SSL (module)">SSL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenSSL/SSL.html#VERIFY_PEER-constant" title="OpenSSL::SSL::VERIFY_PEER (constant)">VERIFY_PEER</a></span></span>
    <span class='id identifier rubyid_store'>store</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenSSL/X509.html" title="OpenSSL::X509 (module)">X509</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenSSL/X509/Store.html" title="OpenSSL::X509::Store (class)">Store</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OpenSSL/X509/Store.html#initialize-instance_method" title="OpenSSL::X509::Store#initialize (method)">new</a></span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:ssl_ca_cert</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:ssl_ca_cert</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="File.html" title="File (class)">File</a></span></span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='id identifier rubyid_cert'>cert</span>
          <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_add_path'>add_path</span> <span class='id identifier rubyid_cert'>cert</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_add_file'>add_file</span> <span class='id identifier rubyid_cert'>cert</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_set_default_paths'>set_default_paths</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_cert_store'>cert_store</span> <span class='op'>=</span> <span class='id identifier rubyid_store'>store</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:read_timeout</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_read_timeout'>read_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:read_timeout</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:open_timeout</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_open_timeout'>open_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:open_timeout</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTP.html" title="Net::HTTP (class)">HTTP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTP/Get.html" title="Net::HTTP::Get (class)">Get</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Net/HTTP.html#new-class_method" title="Net::HTTP.new (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_request_uri'>request_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_header'>header</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:http_basic_authentication</span>
      <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:http_basic_authentication</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_basic_auth'>basic_auth</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='lparen'>(</span><span class='id identifier rubyid_req'>req</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
      <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:content_length_proc</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPSuccess.html" title="Net::HTTPSuccess (class)">HTTPSuccess</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_resp'>resp</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Length</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:content_length_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_resp'>resp</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Length</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:content_length_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_read_body'>read_body</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_str'>str</span><span class='op'>|</span>
        <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:progress_proc</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPSuccess.html" title="Net::HTTPSuccess (class)">HTTPSuccess</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_resp'>resp</span>
          <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:progress_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_each_name'>each_name</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_meta_add_field2'>meta_add_field2</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_get_fields'>get_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_resp'>resp</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPSuccess.html" title="Net::HTTPSuccess (class)">HTTPSuccess</a></span></span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPMovedPermanently.html" title="Net::HTTPMovedPermanently (class)">HTTPMovedPermanently</a></span></span><span class='comma'>,</span> <span class='comment'># 301
</span>       <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPFound.html" title="Net::HTTPFound (class)">HTTPFound</a></span></span><span class='comma'>,</span> <span class='comment'># 302
</span>       <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPSeeOther.html" title="Net::HTTPSeeOther (class)">HTTPSeeOther</a></span></span><span class='comma'>,</span> <span class='comment'># 303
</span>       <span class='const'><span class='object_link'><a href="Net.html" title="Net (module)">Net</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Net/HTTPTemporaryRedirect.html" title="Net::HTTPTemporaryRedirect (class)">HTTPTemporaryRedirect</a></span></span> <span class='comment'># 307
</span>    <span class='kw'>begin</span>
      <span class='id identifier rubyid_loc_uri'>loc_uri</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="URI.html#parse-class_method" title="URI.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_resp'>resp</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/InvalidURIError.html" title="URI::InvalidURIError (class)">InvalidURIError</a></span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OpenURI/HTTPError.html#initialize-instance_method" title="OpenURI::HTTPError#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> (Invalid Location URI)</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_throw'>throw</span> <span class='symbol'>:open_uri_redirect</span><span class='comma'>,</span> <span class='id identifier rubyid_loc_uri'>loc_uri</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OpenURI/HTTPError.html#initialize-instance_method" title="OpenURI::HTTPError#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open_loop-class_method">
  
    .<strong>open_loop</strong>(uri, options)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 182</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open_loop'>open_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:proxy_http_basic_authentication</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:proxy_http_basic_authentication</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:proxy</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:proxy</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>
  <span class='kw'>if</span> <span class='int'>1</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>multiple proxy options specified</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>when</span> <span class='symbol'>:proxy_http_basic_authentication</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:proxy_http_basic_authentication</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>==</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid authenticated proxy option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:proxy_http_basic_authentication</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbol'>:proxy</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:proxy</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>when</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_opt_proxy'>opt_proxy</span>
  <span class='kw'>when</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='id identifier rubyid_pxy'>pxy</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_find_proxy'>find_proxy</span><span class='semicolon'>;</span> <span class='id identifier rubyid_pxy'>pxy</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_pxy'>pxy</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>nil</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='kw'>nil</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="URI.html#parse-class_method" title="URI.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/Generic.html" title="URI::Generic (class)">Generic</a></span></span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid proxy option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_uri_set'>uri_set</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_catch'>catch</span><span class='lparen'>(</span><span class='symbol'>:open_uri_redirect</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="OpenURI/Buffer.html" title="OpenURI::Buffer (class)">Buffer</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OpenURI/Buffer.html#initialize-instance_method" title="OpenURI::Buffer#initialize (method)">new</a></span></span>
      <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_buffer_open'>buffer_open</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_find_proxy'>find_proxy</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span>
      <span class='kw'>nil</span>
    <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='period'>.</span><span class='id identifier rubyid_relative?'>relative?</span>
        <span class='comment'># Although it violates RFC2616, Location: field may have relative
</span>        <span class='comment'># URI.  It is converted to absolute URI using uri as a base URI.
</span>        <span class='id identifier rubyid_redirect'>redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span> <span class='op'>+</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:redirect</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="OpenURI/HTTPRedirect.html" title="OpenURI::HTTPRedirect (class)">HTTPRedirect</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OpenURI/HTTPRedirect.html#initialize-instance_method" title="OpenURI::HTTPRedirect#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_redirectable?'><span class='object_link'><a href="#redirectable%3F-class_method" title="OpenURI.redirectable? (method)">redirectable?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redirection forbidden: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_redirect'>redirect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:http_basic_authentication</span>
        <span class='comment'># send authentication only for the URI directly specified.
</span>        <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
        <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbol'>:http_basic_authentication</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP redirection loop: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_uri_set'>uri_set</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='id identifier rubyid_uri_set'>uri_set</span><span class='lbracket'>[</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>
  <span class='id identifier rubyid_io'>io</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open_uri-class_method">
  
    .<strong>open_uri</strong>(name, *rest)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 140</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open_uri'>open_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/Generic.html" title="URI::Generic (class)">Generic</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>:</span> <span class='const'><span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'><span class='object_link'><a href="URI.html#parse-class_method" title="URI.parse (method)">parse</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_scan_open_optional_arguments'><span class='object_link'><a href="#scan_open_optional_arguments-class_method" title="OpenURI.scan_open_optional_arguments (method)">scan_open_optional_arguments</a></span></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Hash.html" title="Hash (class)">Hash</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra arguments</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_check_options'><span class='object_link'><a href="#check_options-class_method" title="OpenURI.check_options (method)">check_options</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Arb?(?:\Z|:([^:]+))</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_mode'>mode</span>
    <span class='id identifier rubyid_encoding'>encoding</span><span class='comma'>,</span> <span class='op'>=</span> <span class='backref'>$1</span><span class='comma'>,</span><span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='backref'>$1</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='backref'>$1</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='symbol'>:encoding</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_encoding'>encoding</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>encoding specified twice</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='lbracket'>[</span><span class='symbol'>:encoding</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span>
         <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>r</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span>
         <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="File.html" title="File (class)">File</a></span></span><span class='op'>::</span><span class='const'>RDONLY</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid access mode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> resource is read only.)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_open_loop'>open_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><span class='object_link'><a href="OptionParser/Arguable.html#options-instance_method" title="OptionParser::Arguable#options (method)">options</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_set_encoding'>set_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>ensure</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:close!</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close!'>close!</span> <span class='comment'># Tempfile
</span>      <span class='kw'>else</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_io'>io</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirectable?-class_method">
  
    .<strong>redirectable?</strong>(uri1, uri2)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263
264
265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 258</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_redirectable?'>redirectable?</span><span class='lparen'>(</span><span class='id identifier rubyid_uri1'>uri1</span><span class='comma'>,</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='comment'># This test is intended to forbid a redirection from http://... to
</span>  <span class='comment'># file:///etc/passwd, file:///dev/zero, etc.  CVE-2011-1521
</span>  <span class='comment'># https to http redirect is also forbidden intentionally.
</span>  <span class='comment'># It avoids sending secure cookie or referer by non-secure HTTP protocol.
</span>  <span class='comment'># (RFC 2109 4.3.1, RFC 2965 3.3, RFC 2616 15.1.3)
</span>  <span class='comment'># However this is ad hoc.  It should be extensible/configurable.
</span>  <span class='id identifier rubyid_uri1'>uri1</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>||</span>
  <span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?:http|ftp)\z</span><span class='regexp_end'>/i</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_uri1'>uri1</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>&amp;&amp;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?:https?|ftp)\z</span><span class='regexp_end'>/i</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scan_open_optional_arguments-class_method">
  
    .<strong>scan_open_optional_arguments</strong>(*rest)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135
136
137
138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open-uri.rb', line 130</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="OpenURI (module)">OpenURI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_scan_open_optional_arguments'>scan_open_optional_arguments</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Integer.html" title="Integer (class)">Integer</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="Integer.html" title="Integer (class)">Integer</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='id identifier rubyid_perm'>perm</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_perm'>perm</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Feb 26 22:17:33 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>