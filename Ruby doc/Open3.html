<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Open3
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Open3";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (O)</a> &raquo;
    
    
    <span class="title">Open3</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Open3
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/open3.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Open3 grants you access to stdin, stdout, stderr and a thread to wait for
the child process when running another program. You can specify various
attributes, redirections, current directory, etc., of the program in the
same way as for Process.spawn.</p>
<ul><li>
<p>Open3.popen3 : pipes for stdin, stdout, stderr</p>
</li><li>
<p>Open3.popen2 : pipes for stdin, stdout</p>
</li><li>
<p>Open3.popen2e : pipes for stdin, merged stdout and stderr</p>
</li><li>
<p>Open3.capture3 : give a string for stdin; get strings for stdout, stderr</p>
</li><li>
<p>Open3.capture2 : give a string for stdin; get a string for stdout</p>
</li><li>
<p>Open3.capture2e : give a string for stdin; get a string for merged stdout
and stderr</p>
</li><li>
<p>Open3.pipeline_rw : pipes for first stdin and last stdout of a pipeline</p>
</li><li>
<p>Open3.pipeline_r : pipe for last stdout of a pipeline</p>
</li><li>
<p>Open3.pipeline_w : pipe for first stdin of a pipeline</p>
</li><li>
<p>Open3.pipeline_start : run a pipeline without waiting</p>
</li><li>
<p>Open3.pipeline : run a pipeline and wait for its completion</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture2-class_method" title="capture2 (class method)">.<strong>capture2</strong>(*cmd, stdin_data: nil, binmode: false, **opts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture2 captures the standard output of a command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture2e-class_method" title="capture2e (class method)">.<strong>capture2e</strong>(*cmd, stdin_data: nil, binmode: false, **opts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture2e captures the standard output and the standard error of a
command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture3-class_method" title="capture3 (class method)">.<strong>capture3</strong>(*cmd, stdin_data: &#39;&#39;, binmode: false, **opts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture3 captures the standard output and the standard error of a
command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline-class_method" title="pipeline (class method)">.<strong>pipeline</strong>(*cmds, **opts)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline starts a list of commands as a pipeline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_r-class_method" title="pipeline_r (class method)">.<strong>pipeline_r</strong>(*cmds, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_r starts a list of commands as a pipeline with a pipe which
connects to stdout of the last command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_run-class_method" title="pipeline_run (class method)">.<strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_rw-class_method" title="pipeline_rw (class method)">.<strong>pipeline_rw</strong>(*cmds, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_rw starts a list of commands as a pipeline with pipes which
connect to stdin of the first command and stdout of the last command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_start-class_method" title="pipeline_start (class method)">.<strong>pipeline_start</strong>(*cmds, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_start starts a list of commands as a pipeline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_w-class_method" title="pipeline_w (class method)">.<strong>pipeline_w</strong>(*cmds, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_w starts a list of commands as a pipeline with a pipe which
connects to stdin of the first command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen2-class_method" title="popen2 (class method)">.<strong>popen2</strong>(*cmd, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.popen2 is similar to Open3.popen3 except that it doesn&#39;t create a
pipe for the standard error stream.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen2e-class_method" title="popen2e (class method)">.<strong>popen2e</strong>(*cmd, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.popen2e is similar to Open3.popen3 except that it merges the standard
output stream and the standard error stream.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen3-class_method" title="popen3 (class method)">.<strong>popen3</strong>(*cmd, **opts, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open stdin, stdout, and stderr streams and start external executable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen_run-class_method" title="popen_run (class method)">.<strong>popen_run</strong>(cmd, opts, child_io, parent_io)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="capture2-class_method">
  
    .<strong>capture2</strong>(*cmd, stdin_data: nil, binmode: false, **opts)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture2 captures the standard output of a command.</p>

<pre class="code ruby"><code class="ruby">stdout_str, status = Open3.capture2([env,] cmd... [, opts])</code></pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
<code>opts[:stdin_data]</code> and <code>opts[:binmode]</code>.  See
Process.spawn.</p>

<p>If <code>opts[:stdin_data]</code> is specified, it is sent to the
command&#39;s standard input.</p>

<p>If <code>opts[:binmode]</code> is true, internal pipes are set to binary
mode.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># factor is a command for integer factorization.
</span><span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture2'>capture2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>factor</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>42</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span> <span class='comment'>#=&gt; &quot;42: 2 3 7\n&quot;
</span>
<span class='comment'># generate x**2 graph in png using gnuplot.
</span><span class='id identifier rubyid_gnuplot_commands'>gnuplot_commands</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;&quot;End&quot;</span>
<span class='tstring_content'>  set terminal png
  plot x**2, &quot;-&quot; with lines
  1 14
  2 1
  3 8
  4 5
  e
</span><span class='heredoc_end'>End
</span><span class='id identifier rubyid_image'>image</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture2'>capture2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gnuplot</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id identifier rubyid_gnuplot_commands'>gnuplot_commands</span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture2'>capture2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>binmode:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_popen2'>popen2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Thread.html" title="Thread (class)">Thread</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OptionParser/Arguable.html#initialize-instance_method" title="OptionParser::Arguable#initialize (method)">new</a></span></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:readpartial</span>
          <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Errno.html" title="Errno (module)">Errno</a></span></span><span class='op'>::</span><span class='const'>EPIPE</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_out_reader'>out_reader</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="capture2e-class_method">
  
    .<strong>capture2e</strong>(*cmd, stdin_data: nil, binmode: false, **opts)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture2e captures the standard output and the standard error of a
command.</p>

<pre class="code ruby"><code class="ruby">stdout_and_stderr_str, status = Open3.capture2e([env,] cmd... [, opts])</code></pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
<code>opts[:stdin_data]</code> and <code>opts[:binmode]</code>.  See
Process.spawn.</p>

<p>If <code>opts[:stdin_data]</code> is specified, it is sent to the
command&#39;s standard input.</p>

<p>If <code>opts[:binmode]</code> is true, internal pipes are set to binary
mode.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># capture make log
</span><span class='id identifier rubyid_make_log'>make_log</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture2e'>capture2e</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>make</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 348</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture2e'>capture2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>binmode:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_popen2e'>popen2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_oe'>oe</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_oe'>oe</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_outerr_reader'>outerr_reader</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Thread.html" title="Thread (class)">Thread</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OptionParser/Arguable.html#initialize-instance_method" title="OptionParser::Arguable#initialize (method)">new</a></span></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_oe'>oe</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:readpartial</span>
          <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Errno.html" title="Errno (module)">Errno</a></span></span><span class='op'>::</span><span class='const'>EPIPE</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_outerr_reader'>outerr_reader</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="capture3-class_method">
  
    .<strong>capture3</strong>(*cmd, stdin_data: &#39;&#39;, binmode: false, **opts)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture3 captures the standard output and the standard error of a
command.</p>

<pre class="code ruby"><code class="ruby">stdout_str, stderr_str, status = Open3.capture3([env,] cmd... [, opts])</code></pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
<code>opts[:stdin_data]</code> and <code>opts[:binmode]</code>.  See
Process.spawn.</p>

<p>If <code>opts[:stdin_data]</code> is specified, it is sent to the
command&#39;s standard input.</p>

<p>If <code>opts[:binmode]</code> is true, internal pipes are set to binary
mode.</p>

<p>Examples:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># dot is a command of graphviz.
</span><span class='id identifier rubyid_graph'>graph</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;&#39;End&#39;</span>
<span class='tstring_content'>  digraph g {
    a -&gt; b
  }
</span><span class='heredoc_end'>End
</span><span class='id identifier rubyid_drawn_graph'>drawn_graph</span><span class='comma'>,</span> <span class='id identifier rubyid_dot_log'>dot_log</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dot -v</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id identifier rubyid_graph'>graph</span><span class='rparen'>)</span>

<span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>echo abc; sort &gt;&amp;2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span> <span class='comment'>#=&gt; &quot;abc\n&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_e'>e</span> <span class='comment'>#=&gt; &quot;bar\nbaz\nfoo\n&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span> <span class='comment'>#=&gt; #&lt;Process::Status: pid 32682 exit 0&gt;
</span>
<span class='comment'># generate a thumbnail image using the convert command of ImageMagick.
</span><span class='comment'># However, if the image is really stored in a file,
</span><span class='comment'># system(&quot;convert&quot;, &quot;-thumbnail&quot;, &quot;80&quot;, &quot;png:#{filename}&quot;, &quot;png:-&quot;) is better
</span><span class='comment'># because of reduced memory consumption.
</span><span class='comment'># But if the image is stored in a DB or generated by the gnuplot Open3.capture2 example,
</span><span class='comment'># Open3.capture3 should be considered.
</span><span class='comment'>#
</span><span class='id identifier rubyid_image'>image</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="File.html" title="File (class)">File</a></span></span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/openclipart/png/animals/mammals/sheep-md-v0.1.png</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_thumbnail'>thumbnail</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>convert -thumbnail 80 png:- png:-</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id identifier rubyid_image'>image</span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_thumbnail'>thumbnail</span>
<span class='kw'>end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 257</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture3'>capture3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>binmode:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_popen3'>popen3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Thread.html" title="Thread (class)">Thread</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OptionParser/Arguable.html#initialize-instance_method" title="OptionParser::Arguable#initialize (method)">new</a></span></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_err_reader'>err_reader</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Thread.html" title="Thread (class)">Thread</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="OptionParser/Arguable.html#initialize-instance_method" title="OptionParser::Arguable#initialize (method)">new</a></span></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='rbrace'>}</span>
    <span class='kw'>begin</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:readpartial</span>
        <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Errno.html" title="Errno (module)">Errno</a></span></span><span class='op'>::</span><span class='const'>EPIPE</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_out_reader'>out_reader</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_err_reader'>err_reader</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline-class_method">
  
    .<strong>pipeline</strong>(*cmds, **opts)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline starts a list of commands as a pipeline. It waits for the
completion of the commands. No pipes are created for stdin of the first
command and stdout of the last command.</p>

<pre class="code ruby"><code class="ruby">status_list = Open3.pipeline(cmd1, cmd2, ... [, opts])</code></pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code ruby"><code class="ruby">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</code></pre>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_fname'>fname</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/man/man1/ruby.1.gz</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>zcat</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_fname'>fname</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nroff -man</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [#&lt;Process::Status: pid 11817 exit 0&gt;,
</span><span class='comment'>#    #&lt;Process::Status: pid 11820 exit 0&gt;,
</span><span class='comment'>#    #&lt;Process::Status: pid 11828 exit 0&gt;]
</span>
<span class='id identifier rubyid_fname'>fname</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/man/man1/ls.1.gz</span><span class='tstring_end'>&quot;</span></span>
<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>zcat</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_fname'>fname</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nroff -man</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>colcrt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># convert PDF to PS and send to a printer by lpr
</span><span class='id identifier rubyid_pdf_file'>pdf_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paper.pdf</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_printer'>printer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>printer-name</span><span class='tstring_end'>&quot;</span></span>
<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pdftops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_pdf_file'>pdf_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
               <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lpr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-P</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_printer'>printer</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

<span class='comment'># count lines
</span><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uniq -c</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names.txt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># cyclic pipeline
</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span><span class='id identifier rubyid_w'>w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
<span class='id identifier rubyid_w'>w</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ibase=14\n10\n</span><span class='tstring_end'>&quot;</span></span>
<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tee /dev/tty</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='id identifier rubyid_w'>w</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; 14
</span><span class='comment'>#   18
</span><span class='comment'>#   22
</span><span class='comment'>#   30
</span><span class='comment'>#   42
</span><span class='comment'>#   58
</span><span class='comment'>#   78
</span><span class='comment'>#   106
</span><span class='comment'>#   202
</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


614
615
616
617
618</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 614</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline'>pipeline</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
    <span class='id identifier rubyid_ts'>ts</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:value</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline_r-class_method">
  
    .<strong>pipeline_r</strong>(*cmds, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_r starts a list of commands as a pipeline with a pipe which
connects to stdout of the last command.</p>

<pre class="code ruby"><code class="ruby">Open3.pipeline_r(cmd1, cmd2, ... [, opts]) {|last_stdout, wait_threads|
  ...
}

last_stdout, wait_threads = Open3.pipeline_r(cmd1, cmd2, ... [, opts])
...
last_stdout.close</code></pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code ruby"><code class="ruby">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as for Process.spawn.</code></pre>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">Open3.pipeline_r(&quot;zcat /var/log/apache2/access.log.*.gz&quot;,
                 [{&quot;LANG&quot;=&gt;&quot;C&quot;}, &quot;grep&quot;, &quot;GET /favicon.ico&quot;],
                 &quot;logresolve&quot;) {|o, ts|
  o.each_line {|line|
    ...
  }
}

Open3.pipeline_r(&quot;yes&quot;, &quot;head -10&quot;) {|o, ts|
  p o.read      #=&gt; &quot;y\ny\ny\ny\ny\ny\ny\ny\ny\ny\n&quot;
  p ts[0].value #=&gt; #&lt;Process::Status: pid 24910 SIGPIPE (signal 13)&gt;
  p ts[1].value #=&gt; #&lt;Process::Status: pid 24913 exit 0&gt;
}</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


463
464
465
466
467
468</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 463</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_r'>pipeline_r</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline_run-class_method">
  
    .<strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 621</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='comma'>,</span> <span class='id identifier rubyid_child_io'>child_io</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_io'>parent_io</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cmds'>cmds</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no commands</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_opts_base'>opts_base</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_opts_base'>opts_base</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbol'>:in</span>
  <span class='id identifier rubyid_opts_base'>opts_base</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbol'>:out</span>

  <span class='id identifier rubyid_wait_thrs'>wait_thrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_cmds'>cmds</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_cmd_opts'>cmd_opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts_base'>opts_base</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Hash.html" title="Hash (class)">Hash</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:in</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:in</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>!=</span> <span class='id identifier rubyid_cmds'>cmds</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='id identifier rubyid_r2'>r2</span><span class='comma'>,</span> <span class='id identifier rubyid_w2'>w2</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_w2'>w2</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:out</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:out</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_cmd_opts'>cmd_opts</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_wait_thrs'>wait_thrs</span> <span class='op'>&lt;&lt;</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span>
    <span class='id identifier rubyid_w2'>w2</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_w2'>w2</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_r2'>r2</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_io'>parent_io</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='id identifier rubyid_wait_thrs'>wait_thrs</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_child_io'>child_io</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_parent_io'>parent_io</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_wait_thrs'>wait_thrs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:join</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline_rw-class_method">
  
    .<strong>pipeline_rw</strong>(*cmds, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_rw starts a list of commands as a pipeline with pipes which
connect to stdin of the first command and stdout of the last command.</p>

<pre class="code ruby"><code class="ruby">Open3.pipeline_rw(cmd1, cmd2, ... [, opts]) {|first_stdin, last_stdout, wait_threads|
  ...
}

first_stdin, last_stdout, wait_threads = Open3.pipeline_rw(cmd1, cmd2, ... [, opts])
...
first_stdin.close
last_stdout.close</code></pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code ruby"><code class="ruby">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as for Process.spawn.</code></pre>

<p>The options to pass to Process.spawn are constructed by merging
<code>opts</code>, the last hash element of the array, and specifications
for the pipes between each of the commands.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tr -dc A-Za-z</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wc -c</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>All persons more than a mile high to leave the court.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thrs'>wait_thrs</span><span class='op'>|</span>
  <span class='id identifier rubyid_stdin'>stdin</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_stdin'>stdin</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_stdin'>stdin</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_stdin'>stdin</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>     <span class='comment'># send EOF to sort.
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>   <span class='comment'>#=&gt; &quot;     1\tbar\n     2\tbaz\n     3\tfoo\n&quot;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


413
414
415
416
417
418
419
420
421
422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 413</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline_start-class_method">
  
    .<strong>pipeline_start</strong>(*cmds, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_start starts a list of commands as a pipeline. No pipes are
created for stdin of the first command and stdout of the last command.</p>

<pre class="code ruby"><code class="ruby">Open3.pipeline_start(cmd1, cmd2, ... [, opts]) {|wait_threads|
  ...
}

wait_threads = Open3.pipeline_start(cmd1, cmd2, ... [, opts])
...</code></pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code ruby"><code class="ruby">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as for Process.spawn.</code></pre>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Run xeyes in 10 seconds.
</span><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>xeyes</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>10</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TERM</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; #&lt;Process::Status: pid 911 SIGTERM (signal 15)&gt;
</span><span class='rbrace'>}</span>

<span class='comment'># Convert pdf to ps and send it to a printer.
</span><span class='comment'># Collect error message of pdftops and lpr.
</span><span class='id identifier rubyid_pdf_file'>pdf_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paper.pdf</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_printer'>printer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>printer-name</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_err_r'>err_r</span><span class='comma'>,</span> <span class='id identifier rubyid_err_w'>err_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pdftops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_pdf_file'>pdf_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lpr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-P</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_printer'>printer</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='symbol'>:err</span><span class='op'>=&gt;</span><span class='id identifier rubyid_err_w'>err_w</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
  <span class='id identifier rubyid_err_w'>err_w</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_err_r'>err_r</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='comment'># error messages of pdftops and lpr.
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


552
553
554
555
556
557
558
559</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 552</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
    <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ts'>ts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pipeline_w-class_method">
  
    .<strong>pipeline_w</strong>(*cmds, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_w starts a list of commands as a pipeline with a pipe which
connects to stdin of the first command.</p>

<pre class="code ruby"><code class="ruby">Open3.pipeline_w(cmd1, cmd2, ... [, opts]) {|first_stdin, wait_threads|
  ...
}

first_stdin, wait_threads = Open3.pipeline_w(cmd1, cmd2, ... [, opts])
...
first_stdin.close</code></pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code ruby"><code class="ruby">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as for Process.spawn.</code></pre>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipeline_w'>pipeline_w</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bzip2 -c</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/hello.bz2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


499
500
501
502
503
504
505</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 499</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_w'>pipeline_w</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_r'>in_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_w'>in_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="popen2-class_method">
  
    .<strong>popen2</strong>(*cmd, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.popen2 is similar to Open3.popen3 except that it doesn&#39;t create a
pipe for the standard error stream.</p>

<p>Block form:</p>

<pre class="code ruby"><code class="ruby">Open3.popen2([env,] cmd... [, opts]) {|stdin, stdout, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</code></pre>

<p>Non-block form:</p>

<pre class="code ruby"><code class="ruby">stdin, stdout, wait_thr = Open3.popen2([env,] cmd... [, opts])
...
stdin.close  # stdin and stdout should be closed explicitly in this form.
stdout.close</code></pre>

<p>See Process.spawn for the optional hash arguments <em>env</em> and
<em>opts</em>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wc -c</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_o'>o</span><span class='comma'>,</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>answer to life the universe and everything</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bc -q</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_o'>o</span><span class='comma'>,</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>obase=13</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>6 * 9</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dc</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_o'>o</span><span class='comma'>,</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>42P</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='comment'>#=&gt; &quot;*&quot;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141
142
143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 139</span>

<span class='kw'>def</span> <span class='id identifier rubyid_popen2'>popen2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_popen_run'>popen_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="popen2e-class_method">
  
    .<strong>popen2e</strong>(*cmd, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open3.popen2e is similar to Open3.popen3 except that it merges the standard
output stream and the standard error stream.</p>

<p>Block form:</p>

<pre class="code ruby"><code class="ruby">Open3.popen2e([env,] cmd... [, opts]) {|stdin, stdout_and_stderr, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</code></pre>

<p>Non-block form:</p>

<pre class="code ruby"><code class="ruby">stdin, stdout_and_stderr, wait_thr = Open3.popen2e([env,] cmd... [, opts])
...
stdin.close  # stdin and stdout_and_stderr should be closed explicitly in this form.
stdout_and_stderr.close</code></pre>

<p>See Process.spawn for the optional hash arguments <em>env</em> and
<em>opts</em>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"># check gcc warnings
source = &quot;foo.c&quot;
Open3.popen2e(&quot;gcc&quot;, &quot;-Wall&quot;, source) {|i,oe,t|
  oe.each {|line|
    if /warning/ =~ line
      ...
    end
  }
}</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_popen2e'>popen2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='comma'>,</span> <span class='symbol'>:err</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_popen_run'>popen_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="popen3-class_method">
  
    .<strong>popen3</strong>(*cmd, **opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Open stdin, stdout, and stderr streams and start external executable. In
addition, a thread to wait for the started process is created. The thread
has a pid method and a thread variable :pid which is the pid of the started
process.</p>

<p>Block form:</p>

<pre class="code ruby"><code class="ruby">Open3.popen3([env,] cmd... [, opts]) {|stdin, stdout, stderr, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</code></pre>

<p>Non-block form:</p>

<pre class="code ruby"><code class="ruby">stdin, stdout, stderr, wait_thr = Open3.popen3([env,] cmd... [, opts])
pid = wait_thr[:pid]  # pid of the started process
...
stdin.close  # stdin, stdout and stderr should be closed explicitly in this form.
stdout.close
stderr.close
exit_status = wait_thr.value  # Process::Status object returned.</code></pre>

<p>The parameters env, cmd, and opts are passed to Process.spawn. A
commandline string and a list of argument strings can be accepted as
follows:</p>

<pre class="code ruby"><code class="ruby">Open3.popen3(&quot;echo abc&quot;) {|i, o, e, t| ... }
Open3.popen3(&quot;echo&quot;, &quot;abc&quot;) {|i, o, e, t| ... }
Open3.popen3([&quot;echo&quot;, &quot;argv0&quot;], &quot;abc&quot;) {|i, o, e, t| ... }</code></pre>

<p>If the last parameter, opts, is a Hash, it is recognized as an option for
Process.spawn.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="Open3 (module)">Open3</a></span></span><span class='period'>.</span><span class='id identifier rubyid_popen3'>popen3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pwd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='id identifier rubyid_o'>o</span><span class='comma'>,</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span> <span class='comment'>#=&gt; &quot;/&quot;
</span><span class='rbrace'>}</span>
</code></pre>

<p>wait_thr.value waits for the termination of the process. The block form
also waits for the process when it returns.</p>

<p>Closing stdin, stdout and stderr does not wait for the process to complete.</p>

<p>You should be careful to avoid deadlocks. Since pipes are fixed length
buffers, Open3.popen3(prog) {|i, o, e, t| o.read } deadlocks if the
program generates too much output on stderr. You should read stdout and
stderr simultaneously (using threads or IO.select). However, if you
don&#39;t need stderr output, you can use Open3.popen2. If merged stdout
and stderr output is not a problem, you can use Open3.popen2e. If you
really need stdout and stderr output as separate strings, you can consider
Open3.capture3.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_popen3'>popen3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_err_r'>err_r</span><span class='comma'>,</span> <span class='id identifier rubyid_err_w'>err_w</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="IO.html" title="IO (class)">IO</a></span></span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:err</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_err_w'>err_w</span>

  <span class='id identifier rubyid_popen_run'>popen_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span><span class='comma'>,</span> <span class='id identifier rubyid_err_w'>err_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_err_r'>err_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="popen_run-class_method">
  
    .<strong>popen_run</strong>(cmd, opts, child_io, parent_io)  &#x21d2; <tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_popen_run'>popen_run</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_child_io'>child_io</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_io'>parent_io</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Hash.html" title="Hash (class)">Hash</a></span></span><span class='period'>.</span><span class='id identifier rubyid_try_convert'>try_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_wait_thr'>wait_thr</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_child_io'>child_io</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='op'>*</span><span class='id identifier rubyid_parent_io'>parent_io</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thr'>wait_thr</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_parent_io'>parent_io</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:close</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_wait_thr'>wait_thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Feb 26 22:17:31 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>